<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MadinaEnterprises.Modules.Views.DashboardPage"
             BackgroundColor="#242424"
             MinimumHeightRequest="600"
             MinimumWidthRequest="1200"
             Title="Dashboard">

    <Grid ColumnDefinitions="253,*">
        <!-- Sidebar -->
        <BoxView Grid.Column="0" Color="#98cb00"/>
        <BoxView Grid.Column="1" Color="White"/>

        <StackLayout Grid.Column="0" Padding="10" Spacing="30">
            <Button Text="Dashboard" FontSize="Small" BackgroundColor="White" TextColor="Black" CornerRadius="0" Margin="0,50,0,0"/>
            <Button Text="Ginners" FontSize="Small" BackgroundColor="Black" TextColor="White" CornerRadius="0" Clicked="OnGinnersPageButtonClicked"/>
            <Button Text="Mills" FontSize="Small" BackgroundColor="Black" TextColor="White" CornerRadius="0" Clicked="OnMillsPageButtonClicked"/>
            <Button Text="Contracts" FontSize="Small" BackgroundColor="Black" TextColor="White" CornerRadius="0" Clicked="OnContractsPageButtonClicked"/>
            <Button Text="Deliveries" FontSize="Small" BackgroundColor="Black" TextColor="White" CornerRadius="0" Clicked="OnDeliveriesPageButtonClicked"/>
            <Button Text="Payments" FontSize="Small" BackgroundColor="Black" TextColor="White" CornerRadius="0" Clicked="OnPaymentsPageButtonClicked"/>
            <Button Text="Ginner Ledger" FontSize="Small" BackgroundColor="Black" TextColor="White" CornerRadius="0" Clicked="OnGinnerLedgerPageButtonClicked"/>
            <Button Text="Reports" FontSize="Small" BackgroundColor="Black" TextColor="White" CornerRadius="0" Clicked="OnReportsPageButtonClicked"/>
            <Button Text="Backup" FontSize="Small" BackgroundColor="Black" TextColor="White" CornerRadius="0" Clicked="OnBackupClicked"/>
            <Button Text="Logout" FontSize="Small" BackgroundColor="Black" TextColor="White" CornerRadius="0" Clicked="OnLogOutButtonClicked"/>
        </StackLayout>

        <!-- Main Content -->
        <ScrollView Grid.Column="1">
            <VerticalStackLayout Padding="30" Spacing="20">
                <!-- Header with Welcome Message -->
                <Grid ColumnDefinitions="*,Auto">
                    <VerticalStackLayout>
                        <Label x:Name="welcomeLabel" Text="Welcome to Madina Enterprises"
                               FontSize="28"
                               FontAttributes="Bold"
                               TextColor="Black"/>
                        <Label x:Name="dateLabel" Text=""
                               FontSize="14"
                               TextColor="#666"/>
                    </VerticalStackLayout>
                    <Button Grid.Column="1" 
                            Text="Refresh"
                            BackgroundColor="#98cb00"
                            TextColor="White"
                            CornerRadius="5"
                            Clicked="OnRefreshClicked"
                            WidthRequest="100"/>
                </Grid>

                <BoxView HeightRequest="2" BackgroundColor="#98cb00"/>

                <!-- Key Metrics Cards - First Row -->
                <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="15" RowSpacing="15">
                    <!-- Total Revenue Card -->
                    <Frame Grid.Column="0" BackgroundColor="#e8f5e9" Padding="20" CornerRadius="10" HasShadow="True">
                        <VerticalStackLayout Spacing="5">
                            <Label Text="💰" FontSize="30" HorizontalOptions="Center"/>
                            <Label Text="Total Revenue" FontSize="12" TextColor="#666" HorizontalOptions="Center"/>
                            <Label x:Name="totalRevenueLabel" Text="Loading..." 
                                   FontSize="24" FontAttributes="Bold" TextColor="#2e7d32" HorizontalOptions="Center"/>
                            <Label x:Name="revenueChangeLabel" Text="" 
                                   FontSize="10" TextColor="#666" HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Total Commission Card -->
                    <Frame Grid.Column="1" BackgroundColor="#fff3e0" Padding="20" CornerRadius="10" HasShadow="True">
                        <VerticalStackLayout Spacing="5">
                            <Label Text="💵" FontSize="30" HorizontalOptions="Center"/>
                            <Label Text="Total Commission" FontSize="12" TextColor="#666" HorizontalOptions="Center"/>
                            <Label x:Name="totalCommissionLabel" Text="Loading..." 
                                   FontSize="24" FontAttributes="Bold" TextColor="#ef6c00" HorizontalOptions="Center"/>
                            <Label x:Name="commissionPercentLabel" Text="" 
                                   FontSize="10" TextColor="#666" HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Payments Status Card -->
                    <Frame Grid.Column="2" BackgroundColor="#e3f2fd" Padding="20" CornerRadius="10" HasShadow="True">
                        <VerticalStackLayout Spacing="5">
                            <Label Text="✅" FontSize="30" HorizontalOptions="Center"/>
                            <Label Text="Payments Received" FontSize="12" TextColor="#666" HorizontalOptions="Center"/>
                            <Label x:Name="paymentMadeLabel" Text="Loading..." 
                                   FontSize="24" FontAttributes="Bold" TextColor="#1976d2" HorizontalOptions="Center"/>
                            <ProgressBar x:Name="paymentProgressBar" Progress="0" ProgressColor="#1976d2"/>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Outstanding Card -->
                    <Frame Grid.Column="3" BackgroundColor="#ffebee" Padding="20" CornerRadius="10" HasShadow="True">
                        <VerticalStackLayout Spacing="5">
                            <Label Text="⏳" FontSize="30" HorizontalOptions="Center"/>
                            <Label Text="Outstanding Amount" FontSize="12" TextColor="#666" HorizontalOptions="Center"/>
                            <Label x:Name="paymentDueLabel" Text="Loading..." 
                                   FontSize="24" FontAttributes="Bold" TextColor="#d32f2f" HorizontalOptions="Center"/>
                            <Label x:Name="overdueCountLabel" Text="" 
                                   FontSize="10" TextColor="#666" HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Frame>
                </Grid>

                <!-- Operations Metrics - Second Row -->
                <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="15">
                    <!-- Bales Card -->
                    <Frame Grid.Column="0" BackgroundColor="#f3e5f5" Padding="20" CornerRadius="10" HasShadow="True">
                        <VerticalStackLayout Spacing="5">
                            <Label Text="📦" FontSize="30" HorizontalOptions="Center"/>
                            <Label Text="Total Bales" FontSize="12" TextColor="#666" HorizontalOptions="Center"/>
                            <Label x:Name="balesSoldLabel" Text="Loading..." 
                                   FontSize="20" FontAttributes="Bold" TextColor="#7b1fa2" HorizontalOptions="Center"/>
                            <Label x:Name="balesDeliveredLabel" Text="" 
                                   FontSize="10" TextColor="#666" HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Active Contracts Card -->
                    <Frame Grid.Column="1" BackgroundColor="#e0f2f1" Padding="20" CornerRadius="10" HasShadow="True">
                        <VerticalStackLayout Spacing="5">
                            <Label Text="📄" FontSize="30" HorizontalOptions="Center"/>
                            <Label Text="Active Contracts" FontSize="12" TextColor="#666" HorizontalOptions="Center"/>
                            <Label x:Name="activeContractsLabel" Text="Loading..." 
                                   FontSize="20" FontAttributes="Bold" TextColor="#00695c" HorizontalOptions="Center"/>
                            <Label x:Name="contractsThisMonthLabel" Text="" 
                                   FontSize="10" TextColor="#666" HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Ginners Card -->
                    <Frame Grid.Column="2" BackgroundColor="#fce4ec" Padding="20" CornerRadius="10" HasShadow="True">
                        <VerticalStackLayout Spacing="5">
                            <Label Text="🏭" FontSize="30" HorizontalOptions="Center"/>
                            <Label Text="Total Ginners" FontSize="12" TextColor="#666" HorizontalOptions="Center"/>
                            <Label x:Name="totalGinnersLabel" Text="Loading..." 
                                   FontSize="20" FontAttributes="Bold" TextColor="#c2185b" HorizontalOptions="Center"/>
                            <Label x:Name="activeGinnersLabel" Text="" 
                                   FontSize="10" TextColor="#666" HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Mills Card -->
                    <Frame Grid.Column="3" BackgroundColor="#e8eaf6" Padding="20" CornerRadius="10" HasShadow="True">
                        <VerticalStackLayout Spacing="5">
                            <Label Text="🏢" FontSize="30" HorizontalOptions="Center"/>
                            <Label Text="Total Mills" FontSize="12" TextColor="#666" HorizontalOptions="Center"/>
                            <Label x:Name="totalMillsLabel" Text="Loading..." 
                                   FontSize="20" FontAttributes="Bold" TextColor="#3f51b5" HorizontalOptions="Center"/>
                            <Label x:Name="activeMillsLabel" Text="" 
                                   FontSize="10" TextColor="#666" HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Frame>
                </Grid>

                <!-- Performance Indicators -->
                <Label Text="Performance Overview" FontSize="20" FontAttributes="Bold" TextColor="Black" Margin="0,10,0,0"/>

                <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                    <!-- Commission Rate Chart -->
                    <Frame Grid.Column="0" BackgroundColor="#f5f5f5" Padding="15" CornerRadius="10" HasShadow="True">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="Average Commission Rate" FontSize="14" FontAttributes="Bold" TextColor="Black"/>
                            <Grid>
                                <ProgressBar x:Name="commissionProgressBar" 
                                            Progress="0" 
                                            ProgressColor="#98cb00" 
                                            HeightRequest="30"/>
                                <Label x:Name="avgCommissionRateLabel" 
                                       Text="0%" 
                                       HorizontalOptions="Center" 
                                       VerticalOptions="Center"
                                       FontAttributes="Bold"
                                       TextColor="White"/>
                            </Grid>
                            <Label x:Name="commissionDetailsLabel" Text="" FontSize="11" TextColor="#666"/>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Delivery Performance -->
                    <Frame Grid.Column="1" BackgroundColor="#f5f5f5" Padding="15" CornerRadius="10" HasShadow="True">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="Delivery Performance" FontSize="14" FontAttributes="Bold" TextColor="Black"/>
                            <Grid>
                                <ProgressBar x:Name="deliveryProgressBar" 
                                            Progress="0" 
                                            ProgressColor="#1976d2" 
                                            HeightRequest="30"/>
                                <Label x:Name="deliveryPercentLabel" 
                                       Text="0%" 
                                       HorizontalOptions="Center" 
                                       VerticalOptions="Center"
                                       FontAttributes="Bold"
                                       TextColor="White"/>
                            </Grid>
                            <Label x:Name="deliveryDetailsLabel" Text="" FontSize="11" TextColor="#666"/>
                        </VerticalStackLayout>
                    </Frame>
                </Grid>

                <!-- Recent Activity Section -->
                <Label Text="Recent Activity" FontSize="20" FontAttributes="Bold" TextColor="Black" Margin="0,10,0,0"/>

                <Frame BackgroundColor="#f5f5f5" Padding="15" CornerRadius="10" HasShadow="True">
                    <CollectionView x:Name="recentActivityList" HeightRequest="200">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="5" ColumnDefinitions="Auto,*,Auto">
                                    <Label Grid.Column="0" Text="{Binding Icon}" FontSize="20" VerticalOptions="Center"/>
                                    <VerticalStackLayout Grid.Column="1" Margin="10,0">
                                        <Label Text="{Binding Description}" FontSize="13" TextColor="Black"/>
                                        <Label Text="{Binding Timestamp}" FontSize="11" TextColor="#666"/>
                                    </VerticalStackLayout>
                                    <Label Grid.Column="2" Text="{Binding Amount}" FontSize="13" FontAttributes="Bold" TextColor="{Binding AmountColor}" VerticalOptions="Center"/>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </Frame>

                <!-- Quick Actions -->
                <Label Text="Quick Actions" FontSize="20" FontAttributes="Bold" TextColor="Black" Margin="0,10,0,0"/>

                <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="10">
                    <Button Grid.Column="0" 
                            Text="➕ New Contract" 
                            BackgroundColor="#98cb00" 
                            TextColor="White" 
                            CornerRadius="5"
                            Clicked="OnNewContractClicked"/>
                    <Button Grid.Column="1" 
                            Text="📊 View Reports" 
                            BackgroundColor="#1976d2" 
                            TextColor="White" 
                            CornerRadius="5"
                            Clicked="OnViewReportsClicked"/>
                    <Button Grid.Column="2" 
                            Text="💳 Add Payment" 
                            BackgroundColor="#ff9800" 
                            TextColor="White" 
                            CornerRadius="5"
                            Clicked="OnAddPaymentClicked"/>
                    <Button Grid.Column="3" 
                            Text="📦 New Delivery" 
                            BackgroundColor="#7b1fa2" 
                            TextColor="White" 
                            CornerRadius="5"
                            Clicked="OnNewDeliveryClicked"/>
                </Grid>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>